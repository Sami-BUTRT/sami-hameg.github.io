<script>
    async function fetchEmails() {
        const resultDiv = document.getElementById('result');

        // Option A (d√©faut ‚Äî s√ªr pour l'usage interactif) : lire la cl√© depuis le champ input
        const apiKeyFromInput = document.getElementById('apiKey').value;

        // Option B (test local uniquement) : hardcoder temporairement la cl√©
        // const apiKeyFromInput = 'TA_CLE_TESTLOCAL_NE_PAS_COMMIT';

        // Option C (moins recommand√© car visible) : lire ?apikey= dans l'URL si tu veux √©viter de coller manuellement
        // const urlParams = new URLSearchParams(window.location.search);
        // const apiKeyFromInput = urlParams.get('apikey') || '';

        const apiKey = apiKeyFromInput;
        const namespace = "ljfuu";

        if (!apiKey) {
            alert("N'oublie pas de coller ta cl√© API !");
            return;
        }

        resultDiv.innerHTML = "<em>Chargement des messages...</em>";

        const apiUrl = `https://api.testmail.app/api/json?apikey=${apiKey}&namespace=${namespace}&tag=test`;

        try {
            const response = await fetch(apiUrl);
            const data = await response.json();

            if (data.emails && data.emails.length > 0) {
                resultDiv.innerHTML = "";
                data.emails.forEach(email => {
                    const div = document.createElement('div');
                    div.className = 'mail-item';
                    div.innerHTML = `
                        <span class="tag">RE√áU</span><br>
                        <strong>Sujet:</strong> ${email.subject}<br>
                        <strong>De:</strong> ${email.from}<br>
                        <small>${email.text.substring(0, 80)}...</small>
                    `;
                    resultDiv.appendChild(div);
                });
            } else {
                resultDiv.innerHTML = "üì≠ Aucun mail avec le tag <strong>test</strong> trouv√©.";
            }
        } catch (error) {
            resultDiv.innerHTML = "<span style='color:red;'>‚ùå Erreur de connexion ou cl√© invalide.</span>";
            console.error(error);
        }
    }
</script>
